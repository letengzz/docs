# 存储引擎

存储引擎，**是mysql数据库的核心**，需要在合适的场景选择合适的存储引擎。不同的引擎具有不同的应用场景，它们之间没有好坏之分，只需在合适的场景选择合适的引擎。

**存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式** 。**存储引擎是基于表的**，而不是基于库的，所以存储引擎也可被称为表类型。可以在创建表的时候，来指定选择的存储引擎，如果没有指定将自动选择默认的存储引擎。

存储引擎有着很多种，但是我们常用的只有其中三种：[InnoDB](#InnoDB)、[MyISAM](#MyISAM)、[Memory](#Memory)。

## InnoDB

`InnoDB`是一种兼顾高可靠性和高性能的通用存储引擎，在 MySQL 5.5 之后，**InnoDB 是 MySQL 默认的存储引擎**。

它有着如下特点：

- DML（增删改）操作遵循ACID模型，支持**事务**；
- **行级锁**，提高并发访问性能；
- 支持**外键**FOREIGN KEY约束，可以保证数据的完整性和正确性；

**默认情况下**，innoDB引擎的每张表都会对应这样一个表空间文件（`表名.ibd`），存储该表的表结构（frm-早期 、sdi-新版）、数据和索引。

它是由参数：`innodb_file_per_table` 所控制：

```sql
-- ON 代表对于InnoDB引擎的表，每一张表都对应一个ibd文件
show variables  like 'innodb_file_per_table';
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/1e3e656661284ef088dbf3ed165c55b9.png)

我们在文件夹 `C:\ProgramData\MySQL\MySQL Server 8.0\Data`中查看发现确实如此：
![在这里插入图片描述](https://img-blog.csdnimg.cn/7f25d6881ca4405b91881a3b0d63f067.png)

在每个`ibd`文件中不仅存放表结构、数据，还会存放该表对应的 索引信息。 该文件是基于二进制存储的，不能直接基于记事本打开，我们可以使用mysql提供的一 个指令 `ibd2sdi` ，通过该指令就可以从ibd文件中提取sdi信息，而sdi数据字典信息中就包含该表的表结构。
![在这里插入图片描述](https://img-blog.csdnimg.cn/55802ba812e34fe9bccca02de238a082.png)

它的逻辑存储结构是由表空间、段、区、页、行组成的.
![在这里插入图片描述](https://img-blog.csdnimg.cn/c95fd3b5ca88425680efe5578aea7e6e.png)

- **表空间** : InnoDB存储引擎逻辑结构的最高层，ibd文件其实就是表空间文件，在表空间中可以 包含多个Segment段。
- **段** : 表空间是由各个段组成的， 常见的段有数据段、索引段、回滚段等。InnoDB中对于段的管 理，都是引擎自身完成，不需要人为对其控制，一个段中包含多个区。
- **区** : 区是表空间的单元结构，每个区的大小为1M。 默认情况下， InnoDB存储引擎页大小为 16K， 即一个区中一共有64个连续的页。
- **页** : 页是组成区的最小单元，页也是InnoDB 存储引擎磁盘管理的最小单元，每个页的大小默 认为 16KB。为了保证页的连续性，InnoDB 存储引擎每次从磁盘申请 4-5 个区。
- **行** : InnoDB 存储引擎是面向行的，也就是说数据是按行进行存放的，在每一行中除了定义表时 所指定的字段以外，还包含两个隐藏字段。

## MyISAM

`MyISAM`是MySQL早期的默认存储引擎。它不支持事务，不支持外键，不支持行锁，但是它支持表锁，而且**访问速度很快**。

它的每张表对应着三个文件：

- `表名.sdi`：存储表结构信息
- `表名.MYD`: 存储数据
- `表名.MYI`: 存储索引
  ![在这里插入图片描述](https://img-blog.csdnimg.cn/de6a7aa4a4584127a50d9941ff54108d.png)

## Memory

`Memory`引擎的表数据时**存储在内存中**的，由于受到硬件问题、或断电问题的影响，只能将这些表作为 临时表或缓存使用，他的索引**默认为hash索引**。

它通过 `表名.sdi`文件存储表结构信息。

## 对比选择

| 特点         | InnoDB            | MyISAM | Memory |
| ------------ | ----------------- | ------ | ------ |
| 存储限制     | 64TB              | 有     | 有     |
| 事务安全     | 支持              | ×      | ×      |
| 锁机制       | 行锁              | 表锁   | 表锁   |
| B+tree索引   | 支持              | 支持   | 支持   |
| Hash索引     | ×                 | ×      | 支持   |
| 全文索引     | 支持(5.6版本之后) | 支持   | ×      |
| 空间使用     | 高                | 低     | N/A    |
| 内存使用     | 高                | 低     | 中等   |
| 批量插入速度 | 低                | 高     | 高     |
| 支持外键     | 支持              | ×      | ×      |

在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据 实际情况选择多种存储引擎进行组合。

- `InnoDB`: 是Mysql的默认存储引擎，支持事务、外键。如果应用**对事务的完整性有比较高的要求，在并发条件下要求数据的一致**性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。
- `MyISAM` ： 如果应用是**以读操作和插入操作为主**，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。例如记录日志信息的表文件。
- `MEMORY`：将所有数据保存在内存中，访问速度快，**通常用于临时表及缓存**。MEMORY的缺陷就是 对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。

由于目前市面上有更好的`MongoDB`替代`MyISAM`存储引擎的功能以及`Redis`替代`MEMORY`存储引擎的功能，导致其使用的比较少。

## 相关操作

### 查询当前数据库支持的存储引擎

- 语法

```sql
show engines;
1
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/bd238784e4e84976b6a9058a8dfb5f5c.png)

### 建表时指定存储引擎

- 语法

```sql
CREATE TABLE  表名(
字段1  字段1类型   [ COMMENT  字段1注释 ],
 ......
字段n  字段n类型   [COMMENT  字段n注释 ] 
) ENGINE = 存储引擎   [ COMMENT  表注释 ];
12345
```

- 当我们不指定存储引擎的时候，数据库默认为InnoDB

```sql
-- 默认为ENGINE = InnoDB
CREATE TABLE  表名(
字段1  字段1类型   [ COMMENT  字段1注释 ],
 ......
字段n  字段n类型   [COMMENT  字段n注释 ] 
)  [ COMMENT  表注释 ];
123456
```

### 建表后修改存储引擎

- 语法

```sql
alter table 表名 ENGINE = 存储引擎;
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/27a29899d28e4986abdbacdb074b0aa8.png)

### 查看表的存储引擎

- 我们可以通过查看建表语句来查看当前表所使用的存储引擎

```sql
show create table 表名;
1
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/a99f3f3dc9e84a4ba400e9030d52f1a6.png)
