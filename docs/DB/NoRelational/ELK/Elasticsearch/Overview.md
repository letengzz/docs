# Elasticsearch 概述

Elasticsearch 是一款非常强大的开源搜索引擎，可以从海量的数据中快速找到需要的内容。

Elasticsearch 结合 Kibana、Logstash、Beats，也就是 Elastic Stack(ELK)。被广泛应用在日志数据分析、实时监控运行状态等领域。

Elasticsearch 底层是Lucene，是基于Lucene开发的

**官方网站**：https://elastic.co/cn/elasticsearch

![image-20231228162224592](https://fastly.jsdelivr.net/gh/LetengZzz/img@main/tc2/img202312281622915.png)

Elasticsearch是 Elastic Stack 的核心，负责存储、搜索、分析数据：

![img](https://fastly.jsdelivr.net/gh/LetengZzz/img@main/tc2/img202312281633558.jpeg)

## Elasticsearch发展

- 2004年，Shay Banon 基于Lucene开发了Compass
- 2010年，Shay Banon 重写了Compass，取名为Elasticsearch

## "搜索" 概念

搜索，即寻找，设法在庞大的状态空间中找到目标。例如，在百度中寻找自己想要解决问题的答案，只需要在百度中输入对应问题，即可找到答案。

## 使用数据库做搜索

当做站内搜索 (垂直搜索)时，数据量小或简单搜索，可以使用数据库。

但是会存在很多弊端：

- **存储问题**：当数据量过大时，单表数据过大会涉及到拆分表，由此会导致数据库磁盘占用过大，这时就要使用分库来解决。
- **性能问题**：等关键词时，上亿条数据的商品名字段逐行扫描，性能跟不上。
- **不能分词**：如搜索“笔记本电脑”，只能搜索完全和关键词一样的数据，那么数据量小时，搜索“笔记电脑”，“电脑”数据要不要给用户。
- 当互联网搜索时，由于数据量太大 (可能会达到PB)，会导致数据库瘫痪

## 全文检索

数据总体分为两种：**结构化数据** 和**非结构化数据** 。

- **结构化数据**：指具有固定格式或有限长度的数据，如数据库，元数据等。
- **非结构化数据**：指不定长或无固定格式的数据，如邮件，word文档等。

当然有的地方还会提到第三种，半结构化数据，如XML，HTML等，根据需要可按结构化数据来处理，也可抽取出纯文本按非结构化数据来处理。

**非结构化数据又一种叫法叫全文数据。**

按照数据的分类，搜索也分为两种：

- **对结构化数据的搜索**：如对数据库的搜索，用SQL语句。再如对元数据的搜索，如利用windows搜索对文件名，类型，修改时间进行搜索等。
- **对非结构化数据的搜索**：如利用windows的搜索也可以搜索文件内容，Linux下的grep命令，再如用Google和百度可以搜索大量内容数据。

对非结构化数据也即对全文数据的搜索主要有两种方法：

一种是**顺序扫描法** **(Serial Scanning)：** 所谓顺序扫描，比如要找内容包含某一个字符串的文件，就是一个文档一个文档的看，对于每一个文档，从头看到尾，如果此文档包含此字符串，则此文档为我们要找的文件，接着看下一个文件，直到扫描完所有的文件。如利用windows的搜索也可以搜索文件内容，只是相当的慢。如果你有一个80G硬盘，如果想在上面找到一个内容包含某字符串的文件，不花他几个小时，怕是做不到。Linux下的grep命令也是这一种方式。对于小数据量的文件，这种方法还是最直接，最方便的。但是对于大量的文件，这种方法就很慢了。

对非结构化数据顺序扫描很慢，对结构化数据的搜索却相对较快 (由于结构化数据有一定的结构可以采取一定的搜索算法加快速度)。把非结构化数据想办法弄得有一定结构就构成了全文检索的基本思路，也即将非结构化数据中的一部分信息提取出来，重新组织，使其变得有一定结构，然后对此有一定结构的数据进行搜索，从而达到搜索相对较快的目的。

将非结构化数据中的一部分信息提取出来，重新组织，使其变得有一定结构，然后对此有一定结构的数据进行搜索，从而达到搜索相对较快的目的。这部分从非结构化数据中提取出的然后重新组织的信息，称之**索引**。

这种说法比较抽象，举几个例子就很容易明白，比如字典，字典的拼音表和部首检字表就相当于字典的索引，对每一个字的解释是非结构化的，如果字典没有音节表和部首检字表，在茫茫辞海中找一个字只能顺序扫描。然而字的某些信息可以提取出来进行结构化处理，比如读音，就比较结构化，分声母和韵母，分别只有几种可以一一列举，于是将读音拿出来按一定的顺序排列，每一项读音都指向此字的详细解释的页数。我们搜索时按结构化的拼音搜到读音，然后按其指向的页数，便可找到我们的非结构化数据——也即对字的解释。

**这种先建立索引，再对索引进行搜索的过程就叫全文检索(Full-text Search)** 

虽然创建索引的过程也是非常耗时的，但是索引一旦创建就可以多次使用，全文检索主要处理的是查询，所以耗时间创建索引是值得的。

![image-20231228085525483](https://fastly.jsdelivr.net/gh/LetengZzz/img@main/tc2/img202404091724867.png)

## 正向索引

传统数据库(例如MySQL)采用正向索引。基于文档id创建索引。查询词条时必须先找到文档，而后判断是否包含词条。

![image-20231228170327176](https://fastly.jsdelivr.net/gh/LetengZzz/img@main/tc2/img202312281703616.png)

## 倒排索引

Elasticsearch采用倒排索引。数据存储时，经行分词建立term索引库。

倒排索引源于实际应用中需要根据属性的值来查找记录。这种索引表中的每一项都包括一个属性值和具有该属性值的各记录的地址。由于不是由记录来确定属性值，而是由属性值来确定记录的位置，因而称为倒排索引(inverted index)。带有倒排索引的文件称为倒排**索引文件**，简称**倒排文件**(inverted file)。

![image-20231228171329838](https://fastly.jsdelivr.net/gh/LetengZzz/img@main/tc2/img202312281713152.png)

## Lucene

Lucene 是Apache的开源搜索引擎类库，提供了搜索引擎的核心API。**是一个高效的，基于Java** **的全文检索库。**里面封装了全文检索的引擎、搜索的算法代码。开发时，引入lucen的jar包，通过api开发搜索相关业务。底层会在磁盘建立索引库。

**Lucene的优势**：

- 易扩展
- 高性能 (基于倒排索引)

**Lucene的缺点**：

- 只限于java语言开发
- 学习曲线陡峭
- 不支持水平扩展

Elasticsearch相较于Lucene的**优势**：

- 支持分布式，可水平拓展
- 提供Restful接口，可被任何语言调用
