# 企业权限系统设计

## 表设计

企业权限系统设计通常有`sys_user_info` (系统用户表，一般有账号密码)、`sys_dept` (部门表，每个用户是那个部门，一般是一对一关系或一对多关系，且为树形结构)、`sys_role` (角色表，多个角色，与用户表是多对多关系)、`sys_user_role` (用户角色关联表，记录用户和角色的关联信息)、`sys_role_dept` (角色部门关联表，多个部门和多个角色，某个或多个部门拥有某些角色)、`sys_resource` (资源表，用户能操作的资源，一种资源也就是一种权限，包括url、button、file、data等)、`sys_role_res` (角色资源关联表，记录每一个角色能操作的资源)、`sys_user_res` (用户资源关联表，记录那个用户直接操作的资源)

![image-20240810230834917](https://fastly.jsdelivr.net/gh/LetengZzz/img/java/others/202412092337660.png)

**结论**：

1. 一个用户拥有的角色= 用户自己的角色+用户所属部门的角色

2. 部门设计(树形结构)：

   1. 继承关系：当前部门拥有的角色 = 当前部门拥有的角色+上级部门拥有的角色
   2. 派生关系：当前部门拥有的角色 = 当前部门拥有的角色+下级部门拥有的角色

3. 一个用户能操作的资源 = 用户所属角色能操作的所有资源合集 + 用户自己能直接操作的资源

4. 资源表的数据由后台管理系统提供一个授权页面：页面包括 授权矩阵

5. 万物皆资源：

   1. 定义系统中资源的类型(目录、菜单、按钮、文件、数据)

   2. 资源表中的数据：定义好权限模型，启动服务，给资源表插入本系统中拥有的所有资源

   3. 菜单基于访问路径(哪些角色能访问哪些路径) 目录就是菜单的分类(多级分类菜单，父级就是目录)

   4. 每种资源给定一个标识符(权限标识符)：菜单(路径)、按钮(功能描述)

   5. 每个人能操作的权限列表= 角色对应的所有资源的标识符集合(路径)

   6. 数据权限定义到列：在资源表中定义语法比如 1:name 只能读取id为1的数据的name列
   
      进行权限处理，从数据库查出全量数据以后，权限框架自动过滤非指定字段

## 权限设计

每个系统的权限功能都不尽相同，各有其自身的业务特点，对权限管理的设计也都各有特色。

不管是怎样的权限设计，大致可归为三种：**页面权限 (菜单级)**、**操作权限 (按钮级)**、**数据权限**。

### 菜单权限

菜单权限就是对页面的控制，就是有这个权限的用户才能访问这个页面，没这个权限的用户就无法访问，它是以整个页面为维度，对权限的控制并没有那么细，所以是一种**粗颗粒权限**。

![image-20220606155704023](https://fastly.jsdelivr.net/gh/LetengZzz/img/java/others/202412092337396.png)

### 按钮权限

按钮权限就是将页面的**操作**视为资源，比如删除操作，有些人可以操作有些人不能操作。对于后端来说，操作就是一个接口。于前端来说，操作往往是一个按钮，是一种**细颗粒权限**。

![image-20220606160034229](https://fastly.jsdelivr.net/gh/LetengZzz/img/java/others/202412092337316.png)

## 实现方式

- 通过HttpSession进行实现
- 使用token通过[JWT](JWT/index.md)进行实现

