# 数据库

## 什么情况下索引会失效？

- 查询条件使用`OR`且未全部命中索引。
- 使用`LIKE`以`%`开头（如`%abc`）。
- 对字段进行函数操作或类型转换。
- 使用`NOT IN`或`<>`等负向查询。
- 数据量过小或重复值过多时，优化器放弃索引。

## 如何SQL优化

- **建表时，控制索引数量、选择合理的字段类型**

- **避免使用 `select *`，明确使用的字段**：`select *`会走全表扫描，一般不走覆盖索引产生大量的回表查询；增加查询解析器的成本；文本数据、大字段数据传输增加网络消耗。

- **小表驱动大表**：使用数据量较小、索引比较完备的表，然后使用其索引和条件对大表进行数据筛选，从而减少数据计算量，提高查询效率。

- **使用连接查询代替子查询**：子查询会执行两次：一是外部查询，二是嵌套子查询。因此使用连接查询可以减少数据库查询的次数，提高查询的效率。连接查询可以更好的利用数据库索引，提高查询性能。

- **建立索引**：`group by`使用索引

- **可以使用join  或 exists 来代替in子查询**

- **批量操作使用批量插入**：每批数据尽量控制在500以内，如果数据多于500，则分多批次处理

- **查询数据量过多时可以使用limit**：可以提高查询效率、避免过度提取数据、优化分页茶性、简化查询结果

- **使用union all 代替 union**：

  union all：获取所有数据 但是数据不去重，包含重复数据

  union：获取所有数据且数据去重，不包含重复数据

- **join的表不宜过多**：查询效率下降、系统负载增加、维护难度加大